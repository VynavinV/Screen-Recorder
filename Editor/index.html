<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Editor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="app">
    <aside class="sidebar">
        <div id="sidebarResizer" class="resizer"></div>
        <div class="logo">âœ¦ Studio Editor</div>

        <div class="section">
            <div class="section-title">Import Files</div>
            <input type="file" id="screenFile" hidden accept="video/*">
            <input type="file" id="webcamFile" hidden accept="video/*">
            <input type="file" id="clicksFile" hidden accept=".json">
            <button class="btn btn-secondary" onclick="document.getElementById('screenFile').click()" style="margin-bottom:6px;">Import Screen Recording</button>
            <button class="btn btn-secondary" onclick="document.getElementById('webcamFile').click()" style="margin-bottom:6px;">Import Webcam</button>
            <button class="btn btn-secondary" onclick="document.getElementById('clicksFile').click()" style="margin-bottom:6px;">Import Click Data (JSON)</button>
            <button class="btn" onclick="autoDiscoverFiles()" style="margin-bottom:6px;" title="Select a folder containing session subfolders (each with screen.mp4, webcam.mp4, clicks.json)">Auto-Discover Files</button>
            <div style="font-size:11px;color:#888;margin-bottom:12px;">Select a folder with session subfolders containing screen.mp4, webcam.mp4, and clicks.json files</div>
            <div class="status" id="fileStatus">No files loaded</div>
        </div>

        <div class="section">
            <div class="section-title">Video Trimming</div>
            <div class="toggle-row"><span>Enable Trimming</span><div class="toggle" id="trimToggle"></div></div>
            <div class="trim-actions" id="trimActions" style="opacity:0.5; pointer-events:none;">
                <button class="trim-btn" onclick="setTrimStart()">Set Start</button>
                <button class="trim-btn" onclick="setTrimEnd()">Set End</button>
                <button class="trim-btn" onclick="resetTrim()">Reset</button>
            </div>
            <div class="status" id="trimStatus" style="margin-top:8px;">Trimming disabled</div>
        </div>

        <div class="section">
            <div class="section-title">Background</div>
            <div class="toggle-row"><span>Show Background</span><div class="toggle on" id="bgToggle"></div></div>
            <div class="colors" id="colorSwatches">
                <div class="swatch active" style="background:linear-gradient(135deg,#667eea,#764ba2)" data-bg="linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%)"></div>
                <div class="swatch" style="background:linear-gradient(135deg,#f093fb,#f5576c)" data-bg="linear-gradient(135deg,#f093fb 0%,#f5576c 100%)"></div>
                <div class="swatch" style="background:linear-gradient(135deg,#4facfe,#00f2fe)" data-bg="linear-gradient(135deg,#4facfe 0%,#00f2fe 100%)"></div>
                <div class="swatch" style="background:linear-gradient(135deg,#43e97b,#38f9d7)" data-bg="linear-gradient(135deg,#43e97b 0%,#38f9d7 100%)"></div>
                <div class="swatch" style="background:linear-gradient(135deg,#fa709a,#fee140)" data-bg="linear-gradient(135deg,#fa709a 0%,#fee140 100%)"></div>
                <div class="swatch" style="background:#0d0d0d" data-bg="#0d0d0d"></div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Click-to-Zoom</div>
            <div class="toggle-row"><span>Enable Auto Zoom</span><div class="toggle on" id="zoomToggle"></div></div>
            <div class="slider-row">
                <div class="slider-label"><span>Zoom Level</span><span id="zoomVal">2.0x</span></div>
                <input type="range" class="slider" id="zoomSlider" min="1.2" max="4" step="0.1" value="2">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Hold Duration</span><span id="zoomDurVal">1.0s</span></div>
                <input type="range" class="slider" id="zoomDurSlider" min="0.3" max="3" step="0.1" value="1.0">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Anticipation</span><span id="zoomAnticipateVal">0.5s</span></div>
                <input type="range" class="slider" id="zoomAnticipateSlider" min="0.1" max="1.5" step="0.1" value="0.5">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Zoom-In Speed</span><span id="zoomInSpeedVal">0.4s</span></div>
                <input type="range" class="slider" id="zoomInSpeedSlider" min="0.2" max="1.0" step="0.05" value="0.4">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Zoom-Out Speed</span><span id="zoomOutSpeedVal">0.5s</span></div>
                <input type="range" class="slider" id="zoomOutSpeedSlider" min="0.2" max="1.5" step="0.05" value="0.5">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Easing Strength</span><span id="easingVal">0.5</span></div>
                <input type="range" class="slider" id="easingSlider" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Pan Speed</span><span id="panSpeedVal">1.0x</span></div>
                <input type="range" class="slider" id="panSpeedSlider" min="0.3" max="3.0" step="0.1" value="1.0">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Pan Easing</span><span id="panEasingVal">0.5</span></div>
                <input type="range" class="slider" id="panEasingSlider" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Click/Hold Threshold</span><span id="clickThresholdVal">0.15s</span></div>
                <input type="range" class="slider" id="clickThresholdSlider" min="0.05" max="0.5" step="0.01" value="0.15">
            </div>
            <button class="btn btn-secondary" onclick="addTestClick()" style="margin-bottom:4px;">Add Test Click</button>
            <button class="btn btn-secondary" onclick="clearClicks()" style="margin-bottom:4px;">Clear Clicks</button>
            <button class="btn btn-secondary" onclick="downloadClicks()" style="margin-bottom:4px;">Download Clicks</button>
            <div class="status" id="clickStatus">0 click points detected</div>
        </div>

        <div class="section">
            <div class="section-title">Webcam</div>
            <div class="toggle-row"><span>Show Webcam</span><div class="toggle on" id="webcamToggle"></div></div>
            <div class="slider-row">
                <div class="slider-label"><span>Size</span><span id="webcamSizeVal">160px</span></div>
                <input type="range" class="slider" id="webcamSizeSlider" min="80" max="240" value="160">
            </div>
            <div class="toggle-row"><span>Square Shape</span><div class="toggle" id="webcamShapeToggle"></div></div>
        </div>

        <div class="section">
            <div class="section-title">Music / Audio</div>
            <input type="file" id="musicFile" hidden accept="audio/*">
            <button class="btn btn-secondary" onclick="document.getElementById('musicFile').click()" style="margin-bottom:8px;">Import Music (MP3)</button>
            <div class="toggle-row"><span>Enable Music</span><div class="toggle" id="musicToggle"></div></div>
            <div class="slider-row">
                <div class="slider-label"><span>Volume</span><span id="musicVolumeVal">100%</span></div>
                <input type="range" class="slider" id="musicVolumeSlider" min="0" max="100" value="100">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Music Start</span><span id="musicStartVal">0:00</span></div>
                <input type="range" class="slider" id="musicStartSlider" min="0" max="100" value="0">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Music End</span><span id="musicEndVal">0:00</span></div>
                <input type="range" class="slider" id="musicEndSlider" min="0" max="100" value="100">
            </div>
            <div class="slider-row">
                <div class="slider-label"><span>Position on Timeline</span><span id="musicPositionVal">0:00</span></div>
                <input type="range" class="slider" id="musicPositionSlider" min="0" max="100" value="0">
            </div>
            <button class="btn btn-secondary" onclick="removeMusic()" style="margin-top:8px;">Remove Music</button>
            <div class="status" id="musicStatus">No music loaded</div>
        </div>

        <div class="section">
            <div class="section-title">Captions</div>
            <div class="toggle-row"><span>Show Captions</span><div class="toggle" id="captionsToggle"></div></div>
            <button class="btn btn-secondary" id="transcribeBtn" style="margin-top:8px;">Generate Demo Captions</button>
            <button class="btn btn-secondary" onclick="importCaptions()" style="margin-top:4px;">Import SRT/VTT File</button>
            <div class="caption-list hidden" id="captionList"></div>
            <div class="status">Note: Real transcription requires audio processing backend</div>
        </div>

        <div style="margin-top:auto; padding-top: 10px;">
            <button class="btn" id="exportBtn">Export Video</button>
        </div>
    </aside>

    <main class="main">
        <div class="canvas-wrap">
            <div class="video-canvas" id="canvas">
                <div class="gradient-bg" id="gradBg"></div>
                <div class="video-frame" id="videoFrame">
                    <video id="mainVideo" playsinline></video>
                </div>
                <div class="webcam-wrap hidden" id="webcamWrap">
                    <video id="webcamVideo" playsinline muted></video>
                </div>
                <div class="captions-box" id="captionsBox"></div>
            </div>
        </div>
        <div class="trim-controls">
            <button class="play-btn" id="playBtn">
                <svg viewBox="0 0 24 24" id="playIcon"><path d="M8 5v14l11-7z"/></svg>
            </button>
            <div class="timeline-container">
                <div class="timeline" id="timeline">
                    <div class="timeline-progress" id="progress"></div>
                    <div class="trim-dim left hidden" id="trimDimLeft"></div>
                    <div class="trim-dim right hidden" id="trimDimRight"></div>
                    <div class="trim-area" id="trimArea"></div>
                    <div class="trim-handle left" id="trimHandleLeft"></div>
                    <div class="trim-handle right" id="trimHandleRight"></div>
                </div>
                <div class="timeline-clicks" id="clickMarkers"></div>
                <div class="timeline-music" id="musicTrack"></div>
                <div class="trim-times">
                    <div class="trim-time" id="trimStartTime">Start: 0:00</div>
                    <div class="trim-time" id="trimEndTime">End: 0:00</div>
                </div>
            </div>
            <span class="time" id="timeDisp">0:00 / 0:00</span>
        </div>
    </main>
</div>

<div class="modal" id="exportModal">
    <div class="modal-box">
        <h2>Exporting Video</h2>
        <svg class="progress-ring" viewBox="0 0 100 100">
            <defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#667eea"/><stop offset="100%" stop-color="#764ba2"/></linearGradient></defs>
            <circle class="bg" cx="50" cy="50" r="32"/>
            <circle class="bar" id="exportBar" cx="50" cy="50" r="32"/>
        </svg>
        <p id="exportStatus">Preparing...</p>
    </div>
</div>

    <script src="script.js"></script>
</body>
</html>
